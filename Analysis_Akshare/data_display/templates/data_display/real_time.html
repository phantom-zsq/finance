<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>期权品种打分系统_实时</title>
    <style>
        body {
            font-family: "Microsoft Yahei", Arial, sans-serif;
            max-width: 100%; /* 改为100%适配宽屏，原1300px易限制宽屏展示 */
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
            overflow-x: hidden; /* 防止页面横向溢出 */
        }
        .container {
            text-align: center;
            padding: 0 5px;
        }
        .refresh-info {
            color: #666;
            margin-bottom: 15px; /* 减少底部间距，节省空间 */
            font-size: 14px;
        }
        /* 表格容器优化：增强滚动体验 */
        .table-wrapper {
            overflow-x: auto;
            margin-top: 10px;
            border-radius: 4px;
            box-shadow: 0 0 3px rgba(0,0,0,0.1); /* 轻微阴影提升层次感 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px; /* 保证表格最小宽度，避免过度压缩 */
        }
        /* 表头优化核心：合理分配列宽+文字换行 */
        th {
            background-color: #f5f5f5;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 10px 4px; /* 上下padding增加，左右减少，平衡空间 */
            border: 1px solid #ddd;
            text-align: center; /* 表头居中更易读 */
            font-size: 12px;
            font-weight: normal; /* 取消粗体，减少视觉拥挤感 */
            white-space: nowrap; /* 表头文字不换行（关键：避免高度增加） */
        }
        /* 按字段重要性和内容长度分配列宽 */
        th:nth-child(1) { width: 50px; }    /* 序号 */
        th:nth-child(2) { width: 80px; }    /* 交易所 */
        th:nth-child(3) { width: 90px; }    /* 品种名称 */
        th:nth-child(4) { width: 120px; }   /* 合约名称（内容较长） */
        th:nth-child(5) { width: 70px; }    /* 当前价 */
        th:nth-child(6) { width: 70px; }    /* 行权价 */
        th:nth-child(7) { width: 80px; }    /* 涨跌停比例 */
        th:nth-child(8) { width: 70px; }    /* 八八分位 */
        th:nth-child(9) { width: 70px; }    /* 八四分位 */
        th:nth-child(10) { width: 70px; }   /* 八三分位 */
        th:nth-child(11) { width: 70px; }   /* 八二分位 */
        th:nth-child(13) { width: 70px; }   /* 剩余天数 */
        th:nth-child(14) { width: 70px; }   /* 深度分值 */
        th:nth-child(15) { width: 70px; }   /* 权利金 */
        th:nth-child(16) { width: 70px; }   /* 手续费 */
        th:nth-child(17) { width: 70px; }   /* 保证金率 */
        th:nth-child(18) { width: 80px; }   /* 性价比分值 */
        th:nth-child(19) { width: 60px; }   /* 多空 */
        th:nth-child(20) { width: 70px; }   /* 技术分值 */
        th:nth-child(21) { width: 70px; }   /* 现货价 */
        th:nth-child(22) { width: 70px; }   /* 期货价 */
        th:nth-child(23) { width: 70px; }   /* 基差分值 */
        th:nth-child(24) { width: 70px; }   /* 总分 */

        /* 单元格优化 */
        td {
            padding: 8px 4px;
            border: 1px solid #ddd;
            text-align: center; /* 内容居中，提升对齐感 */
            font-size: 12px;
            white-space: nowrap; /* 单元格内容不换行，保证一行展示 */
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        /* 加载状态优化 */
        .loading {
            color: #007bff;
            display: none;
            padding: 15px;
            font-weight: bold;
            animation: blink 1s infinite alternate;
        }
        @keyframes blink {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        /* 错误提示样式 */
        .error-tip {
            color: #dc3545;
            text-align: center;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>期权品种打分系统_实时数据</h1>
        <div class="refresh-info">
            数据将每600秒自动刷新一次 | 上次刷新: <span id="last-refresh"></span>
        </div>
        <div class="loading" id="loading">正在刷新数据...</div>
        <div class="error-tip" id="error-tip">数据刷新失败，请稍后重试！</div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>交易所</th>
                        <th>品种名称</th>
                        <th>合约名称</th>
                        <th>当前价</th>
                        <th>行权价</th>
                        <th>涨跌停比例</th>
                        <th>八八分位</th>
                        <th>八四分位</th>
                        <th>八三分位</th>
                        <th>八二分位</th>
                        <th>剩余天数</th>
                        <th>深度分值</th>
                        <th>权利金</th>
                        <th>手续费</th>
                        <th>平今</th>
                        <th>保证金率</th>
                        <th>性价比分值</th>
                        <th>多空</th>
                        <th>技术分值</th>
                        <th>现货价</th>
                        <th>期货价</th>
                        <th>基差分值</th>
                        <th>总分</th>
                    </tr>
                </thead>
                <tbody id="data-container">
                    {% for record in records %}
                    <tr>
                        <td class="serial-number"></td>
                        <td>{{ record.交易所 }}</td>
                        <td>{{ record.品种名称 }}</td>
                        <td>{{ record.合约名称 }}</td>
                        <td>{{ record.当前价 }}</td>
                        <td>{{ record.行权价 }}</td>
                        <td>{{ record.涨跌停比例 }}</td>
                        <td>{{ record.八八分位 }}</td>
                        <td>{{ record.八四分位 }}</td>
                        <td>{{ record.八三分位 }}</td>
                        <td>{{ record.八二分位 }}</td>
                        <td>{{ record.剩余天数 }}</td>
                        <td>{{ record.深度分值 }}</td>
                        <td>{{ record.权利金 }}</td>
                        <td>{{ record.手续费 }}</td>
                        <td>{{ record.平今 }}</td>
                        <td>{{ record.保证金率 }}</td>
                        <td>{{ record.性价比分值 }}</td>
                        <td>{{ record.多空 }}</td>
                        <td>{{ record.技术分值 }}</td>
                        <td>{{ record.现货价 }}</td>
                        <td>{{ record.期货价 }}</td>
                        <td>{{ record.基差分值 }}</td>
                        <td>{{ record.总分 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="24" style="text-align: center;">暂无数据，请检查数据库</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const CONFIG = {
            refreshInterval: 600000,
            elements: {
                loading: document.getElementById('loading'),
                dataContainer: document.getElementById('data-container'),
                lastRefresh: document.getElementById('last-refresh'),
                errorTip: document.getElementById('error-tip')
            }
        };

        function fillSerialNumber() {
            if (!CONFIG.elements.dataContainer) return;
            const serialCells = document.querySelectorAll('.serial-number');
            serialCells.forEach((cell, index) => {
                cell.textContent = index + 1;
            });
        }

        function refreshData() {
            CONFIG.elements.errorTip.style.display = 'none';
            CONFIG.elements.loading.style.display = 'block';

            fetch(window.location.href, { cache: 'no-cache' })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP错误：${response.status}`);
                return response.text();
            })
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const newData = doc.getElementById('data-container')?.innerHTML || '';
                if (newData) {
                    CONFIG.elements.dataContainer.innerHTML = newData;
                    CONFIG.elements.lastRefresh.textContent = new Date().toLocaleString();
                }
            })
            .catch(error => {
                console.error('刷新数据失败:', error);
                CONFIG.elements.errorTip.style.display = 'block';
            })
            .finally(() => {
                CONFIG.elements.loading.style.display = 'none';
                fillSerialNumber();
            });
        }

        function init() {
            if (CONFIG.elements.lastRefresh) {
                CONFIG.elements.lastRefresh.textContent = new Date().toLocaleString();
            }
            fillSerialNumber();
            setInterval(refreshData, CONFIG.refreshInterval);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>